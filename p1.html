<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chashmah AI | Multi-Frame Sync</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --neon: #00ff41; --dark: #050505; }
        body { background: var(--dark); color: var(--neon); font-family: 'Courier New', monospace; padding-top: 50px; }
        
        .hud-container { 
            border: 2px solid var(--neon); padding: 30px; border-radius: 20px; 
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); background: rgba(0, 0, 0, 0.9); 
        }

        /* Frame Box Styling */
        .lens-box { 
            border: 1px solid var(--neon); height: 180px; position: relative;
            background: rgba(0, 255, 65, 0.05); overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
        }
        .lens-box:hover { background: rgba(0, 255, 65, 0.15); }

        .lens-box img {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; opacity: 0.7; z-index: 1;
        }

        .lens-content { z-index: 2; text-shadow: 2px 2px #000; text-align: center; pointer-events: none; }
        
        .status-badge { border: 1px solid var(--neon); padding: 5px 15px; border-radius: 50px; font-size: 0.75rem; }
        .json-viewer { background: #111; border: 1px solid #333; color: #888; padding: 10px; font-size: 11px; border-radius: 5px; height: 150px; overflow-y: auto; }
        
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="container hud-container col-lg-10">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="m-0">MULTI-LENS SOURCE SYNC</h2>
        <span class="status-badge" id="sync-status">READY</span>
    </div>

    <div class="row g-3 mb-4 text-center">
        <div class="col-md-3">
            <label class="lens-box" id="box-1">
                <input type="file" onchange="previewFrame(event, 1)" accept="image/*">
                <div class="lens-content" id="content-1">F1<br><small>[TAP TO UPLOAD]</small></div>
            </label>
        </div>
        <div class="col-md-3">
            <label class="lens-box" id="box-2">
                <input type="file" onchange="previewFrame(event, 2)" accept="image/*">
                <div class="lens-content" id="content-2">F2<br><small>[TAP TO UPLOAD]</small></div>
            </label>
        </div>
        <div class="col-md-3">
            <label class="lens-box" id="box-3">
                <input type="file" onchange="previewFrame(event, 3)" accept="image/*">
                <div class="lens-content" id="content-3">F3<br><small>[TAP TO UPLOAD]</small></div>
            </label>
        </div>
        <div class="col-md-3">
            <label class="lens-box" id="box-4">
                <input type="file" onchange="previewFrame(event, 4)" accept="image/*">
                <div class="lens-content" id="content-4">F4<br><small>[TAP TO UPLOAD]</small></div>
            </label>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <label class="small text-uppercase mb-2 text-secondary">Metadata Stream</label>
            <div class="json-viewer" id="raw-json">// Encrypted stream idle...</div>
        </div>
        <div class="col-md-6 d-flex align-items-end">
            <button onclick="generateFinalJson()" class="btn btn-outline-success w-100 fw-bold py-3 mt-3">
                GENERATE SYNC OBJECT
            </button>
        </div>
    </div>
</div>

<script>
    // System state to store metadata for each frame
    let hudState = {
        device: "CHASHMAH-V1",
        frames: { 1: null, 2: null, 3: null, 4: null }
    };

    function previewFrame(event, frameId) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const box = document.getElementById(`box-${frameId}`);
            const content = document.getElementById(`content-${frameId}`);
            
            // Remove existing image if any
            const existingImg = box.querySelector('img');
            if (existingImg) existingImg.remove();

            // Inject new image preview
            const img = document.createElement('img');
            img.src = e.target.result;
            box.appendChild(img);

            // Update UI
            content.innerHTML = `<strong>F${frameId}</strong><br><small>SYNCED</small>`;
            box.style.borderColor = "#ffffff";

            // Update state
            hudState.frames[frameId] = {
                filename: file.name,
                size: (file.size / 1024).toFixed(1) + "KB",
                timestamp: new Date().toLocaleTimeString()
            };
            
            updateJsonDisplay();
        };
        reader.readAsDataURL(file);
    }

    function updateJsonDisplay() {
        document.getElementById('raw-json').textContent = JSON.stringify(hudState, null, 4);
    }

    function generateFinalJson() {
        const activeFrames = Object.values(hudState.frames).filter(f => f !== null).length;
        if (activeFrames === 0) {
            alert("No frames detected. Please upload at least one image.");
            return;
        }
        
        document.getElementById('sync-status').textContent = "CLOUD SYNC ACTIVE";
        document.getElementById('sync-status').style.background = "rgba(0, 255, 65, 0.4)";
        updateJsonDisplay();
        console.log("Final JSON Object for API:", hudState);
    }
</script>

</body>
</html>